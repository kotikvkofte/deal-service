# Deal Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏ (–¥–æ–≥–æ–≤–æ—Ä–∞–º–∏, —Å—É–º–º–∞–º–∏, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏ –∏ –∏—Ö —Ä–æ–ª—è–º–∏), —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å —Å–µ—Ä–≤–∏—Å–æ–º –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ RabbitMQ.

---

## üìÜ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

* ‚úÖ CRUD –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏ `–°–¥–µ–ª–∫–∞`
* ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏ –∏ –∏—Ö —Ä–æ–ª—è–º–∏
* ‚úÖ –ü–æ–∏—Å–∫ —Å–¥–µ–ª–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
* ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–¥–µ–ª–∫–∏
* ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (—Å —Ü–≤–µ—Ç–æ–º –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π)
* ‚úÖ –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ `is_active`
* ‚úÖ Liquibase –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
* ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `Contractor Service` —á–µ—Ä–µ–∑ RabbitMQ
* ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ **Inbox/Outbox** –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
* ‚úÖ Dead-letter –∏ retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π

---

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –°—Ç–µ–∫              | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ     |
| ----------------- | ---------------- |
| Java              | 17+              |
| Spring Boot       | 3.x              |
| Spring Data JPA   | PostgreSQL       |
| Hibernate         | 6.x              |
| Liquibase         | –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã    |
| Apache POI        | –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel  |
| Swagger (OpenAPI) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API |
| Lombok            | –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞   |
| Maven             | –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞   |
| RabbitMQ          |–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è|

---

## üì° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Contractor Service

### –ü–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
1. **Contractor Service** –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –≤ `contractors_contractor_exchange`.
2. –°–æ–æ–±—â–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å `deals_contractor_queue`.
3. `Deal Service` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –≤ —Å–¥–µ–ª–∫–∞—Ö.
4. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏:
    - —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Ö–æ–¥–∏—Ç –≤ `deals_dead_contractor_queue`.
    - —á–µ—Ä–µ–∑ **5 –º–∏–Ω—É—Ç** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `deals_contractor_queue` (retry-–ø–æ–ª–∏—Ç–∏–∫–∞).
5. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Inbox —Ç–∞–±–ª–∏—Ü–∞**, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

---

## üìÖ API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –°–¥–µ–ª–∫–∏

| Method | URI                   | Description               |
| ------ | --------------------- | ------------------------- |
| PUT    | `/deal/save`          | –°–æ–∑–¥–∞—Ç—å / –æ–±–Ω–æ–≤–∏—Ç—å —Å–¥–µ–ª–∫—É |
| PATCH  | `/deal/change/status` | –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏    |
| GET    | `/deal/deal/{id}`     | –ü–æ–ª—É—á–∏—Ç—å —Å–¥–µ–ª–∫—É –ø–æ ID     |
| POST   | `/deal/search`        | –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π       |
| POST   | `/deal/search/export` | üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel        |

### –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã

| Method | URI                            | Description            |
| ------ | ------------------------------ | ---------------------- |
| PUT    | `/deal-contractor/save`        | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ |
| DELETE | `/deal-contractor/delete/{id}` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ    |

### –†–æ–ª–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤

| Method | URI                          | Description               |
| ------ | ---------------------------- |---------------------------|
| POST   | `/contractor-to-role/add`    | –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É |
| DELETE | `/contractor-to-role/delete` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ       |

---

## üìÑ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç Excel

```json
{
  "page": 0,
  "size": 20,
  "sortBy": "agreementDate",
  "sortDirection": "DESC",
  "description": "–∫—Ä–µ–¥–∏—Ç"
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: Excel-—Ñ–∞–π–ª `.xlsx` —Å —Å–¥–µ–ª–∫–∞–º–∏.
![img.png](img.png)
---

## üìÅ Liquibase

–ú–∏–≥—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤:

```
src/main/resources/db/changelog/
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```json
{
  "message": "Deal with id '...' not found",
  "timestamp": "2025-07-14T14:00:00"
}
```
---

---
## üì¶ Inbox / Outbox –ø–∞—Ç—Ç–µ—Ä–Ω

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π:

### Outbox: 
Contractor Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É outbox_event, –∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —à–µ–¥—É–ª–µ—Ä –ø—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –≤ RabbitMQ.

### Inbox:
Deal Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É inbox_event, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Å–æ–±—ã—Ç–∏—è.

---

## üí° –°—Ç–∞—Ä—Ç –ª–æ–∫–∞–ª—å–Ω–æ —Å Docker

1. –°–æ–∑–¥–∞—Ç—å `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
DB_NAME=deal-service-db
DB_USER=user
DB_PASSWORD=1
```
2. –°—Ç–∞—Ä—Ç:
```bash
docker compose up --build
```

---

## üë§ –ê–≤—Ç–æ—Ä

**–ö—Ä–∞–∫–æ–≤—Ü–µ–≤ –ê—Ä—Ç—ë–º**
